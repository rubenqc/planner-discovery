(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"3abb":function(t,e,a){"use strict";var n=a("6053"),i=a.n(n);i.a},6053:function(t,e,a){},"8b24":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"flex column justify-start items-center"},[a("h1",{staticClass:"h1"},[t._v("Lista de Enlaces de red")]),a("LinkTable")],1)},i=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-pa-lg",staticStyle:{"max-width":"90vw"}},[a("q-table",{staticClass:"my-sticky-column-table",staticStyle:{width:"100%"},attrs:{title:"Enlaces",data:t.data,columns:t.columns,"row-key":"_id",pagination:t.pagination,loading:t.loading,"binary-state-sort":""},on:{"update:pagination":function(e){t.pagination=e},request:t.onRequestPaginate},scopedSlots:t._u([{key:"top",fn:function(){return[a("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",disable:t.loading,label:"Registar Enlace"},on:{click:function(e){t.modalCreate=!0}}}),a("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",disable:t.loading,label:"Limpiar Busqueda"},on:{click:t.clearInputs}}),a("q-btn",{attrs:{color:"primary",disable:t.loading,label:"Exportar"},on:{click:t.download}})]},proxy:!0},{key:"header",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-th",{attrs:{"auto-width":""}},[t._v("Opciones")]),t._l(e.cols,(function(n){return a("q-th",{key:n.name,attrs:{props:e}},[t._v(t._s(n.label))])}))],2)]}},{key:"body",fn:function(e){return[a("q-tr",{staticClass:"paint",attrs:{props:e}},[a("q-td",{attrs:{"auto-width":""}},[a("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",color:"primary",round:"",dense:"",icon:e.expand?"keyboard_arrow_up":"expand_more"},on:{click:function(t){e.expand=!e.expand}}}),a("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",color:"positive",round:"",dense:"",icon:"create"},on:{click:function(a){return t.openEditform(e.row)}}}),a("q-btn",{attrs:{size:"sm",color:"negative",round:"",dense:"",icon:"close"},on:{click:function(a){return t.openDeleteModal(e.row)}}})],1),t._l(e.cols,(function(n){return a("q-td",{key:n.name,class:n.name,attrs:{props:e}},[t._v(t._s(n.value))])}))],2),a("q-tr",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"props.expand"}],staticClass:"col-",attrs:{props:e}},[a("q-td",{staticStyle:{"padding-left":"0"},attrs:{colspan:"100%"}},[a("DetailLink",{key:e.row._id,attrs:{link:e.row}})],1)],1)]}},{key:"bottom-row",fn:function(){return[a("q-tr",[a("q-td",{attrs:{"auto-width":""}}),t._l(t.columns,(function(e){return a("q-td",{key:e.name,attrs:{"auto-width":""}},["status"===e.name?a("q-select",{staticStyle:{"min-width":"150px"},attrs:{dense:"",filled:"",options:t.select.statusOptions},on:{input:t.updateSelectStatus},model:{value:t.body.status,callback:function(e){t.$set(t.body,"status",e)},expression:"body.status"}}):"media"===e.name?a("q-select",{staticStyle:{"min-width":"150px"},attrs:{dense:"",filled:"",options:t.select.mediaOptions},on:{input:t.updateSelectMedia},model:{value:t.body.media,callback:function(e){t.$set(t.body,"media",e)},expression:"body.media"}}):a("q-input",{staticStyle:{"min-width":"150px"},attrs:{dense:"",filled:""},on:{input:function(a){return t.updateInput(a,e.name)}},model:{value:t.body[e.name],callback:function(a){t.$set(t.body,e.name,a)},expression:"body[col.name]"}})],1)}))],2)]},proxy:!0}])}),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalFile,callback:function(e){t.modalFile=e},expression:"modalFile"}},[a("q-card",{staticStyle:{"min-width":"350px"}},[a("form",{attrs:{enctype:"multipart/form-data"},on:{submit:function(e){return e.preventDefault(),t.uploadExcel(e)}}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("SmartCapex")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-file",{attrs:{filled:"","bottom-slots":"",label:"Seleccione",name:"excel",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","max-files":"1"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"attach_file"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),t.file=null}}})]},proxy:!0}]),model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",type:"submit",label:"Subir Archivo"}})],1)],1)])],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalCharge,callback:function(e){t.modalCharge=e},expression:"modalCharge"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Cargando")])]),a("q-card-section",{staticClass:"q-pt-none flex column items-center justify-center"},[a("q-spinner-bars",{attrs:{color:"primary",size:"5.5em"}}),a("p",[t._v("por favor no cierre la pestaña.")])],1)],1)],1),a("q-dialog",{attrs:{position:"top",seamless:"",persistent:""},model:{value:t.modalError,callback:function(e){t.modalError=e},expression:"modalError"}},[a("q-card",[a("q-card-section",{staticClass:"text-red"},[t._v("\n        Al parecer hubo un error realizando la operación\n        "),a("q-icon",{staticClass:"text-red",staticStyle:{"font-size":"2rem"},attrs:{name:"warning"}})],1)],1)],1),a("q-dialog",{attrs:{position:"top",seamless:"",persistent:""},model:{value:t.modalOk,callback:function(e){t.modalOk=e},expression:"modalOk"}},[a("q-card",[a("q-card-section",{staticClass:"text-green-5"},[t._v("\n        Operación Realizada con exito\n        "),a("q-icon",{staticClass:"text-green-5",staticStyle:{"font-size":"2rem"},attrs:{name:"check_circle"}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalConfirmDelete,callback:function(e){t.modalConfirmDelete=e},expression:"modalConfirmDelete"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"warning",color:"negative","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[t._v("Estás seguro de que deseas eliminar este enlace?")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"primary"}}),a("q-btn",{attrs:{flat:"",label:"Confirmar",color:"primary"},on:{click:t.deleteLink}})],1)],1)],1),a("FormCreate",{attrs:{layout:t.modalCreate},on:{onClose:function(e){t.modalCreate=!1},onSuccess:function(e){return t.alertar(!1)},onError:function(e){return t.alertar(!0)}}}),a("FormEdit",{attrs:{layout:t.modalEdit,form:t.linkEdit},on:{onClose:function(e){t.modalEdit=!1},onSuccess:function(e){return t.alertar(!1)},onError:function(e){return t.alertar(!0)}}})],1)},l=[],s=(a("4e82"),a("a434"),a("e6cf"),a("5319"),a("ddb0"),a("2b3d"),a("ded3")),r=a.n(s),d=a("c973"),c=a.n(d),u=a("2f62"),p=a("c1df"),m=a.n(p),g=a("9108"),f=a("8a61"),b=a("a279"),y={name:"MainTable",components:{FormCreate:g["a"],DetailLink:b["a"],FormEdit:f["a"]},data(){return{select:{statusOptions:["Todos","danger","warning","ok","observado","sin-instancia"],mediaOptions:["Todos","BH","LH","FO","RENTADO-FO"]},typing:null,body:{sourceSite:null,sinkSite:null,utilization:null,media:"Todos",capacity:null,instanceName:null,status:"Todos"},loading:!0,pagination:{page:1,rowsPerPage:5,rowsNumber:0,sortBy:"utilization",descending:!1},columns:[{name:"sourceSite",label:"Source Site",field:t=>t.nearEnd.name,align:"left"},{name:"sinkSite",label:"Sink Site",field:t=>t.farEnd.name,align:"left"},{name:"status",label:"Estado",field:"status",align:"left"},{name:"utilization",label:"Utilización (%)",field:"lastMaxutilization",align:"left",sortable:!0},{name:"media",label:"Medio",field:"media",align:"left"},{name:"capacity",label:"Capacidad",field:"capacity",align:"left"},{name:"instanceName",label:"Nombre de Instancia",field:"instanceName",align:"left"},{name:"forecastDate",label:"Fecha de Forecast",field:"forecastDate",align:"left"},{name:"updatedDate",label:"Fecha de Actualización",field:"updatedDate",align:"left"},{name:"typeVisualization",label:"Tipo",field:"typeVisualization",align:"left"},{name:"stageVisualization",label:"Estación",field:"stageVisualization",align:"left"}],data:[],modalFile:!1,modalCharge:!1,file:null,modalCreate:!1,modalEdit:!1,modalError:!1,modalOk:!1,modalConfirmDelete:!1,linkEdit:null,linkDelete:null}},created(){const t=this.bodyBuilder(this.pagination);this.getData(t)},methods:{getData(t={}){var e=this;return c()((function*(){const a=yield e.$axios.post(e.LINKS_URL+"/listByQuery",r()({},t));return e.data.splice(0,e.data.length,...a.data.docs),e.pagination.page=a.data.page,e.pagination.rowsPerPage=a.data.limit,e.pagination.rowsNumber=a.data.totalDocs,t.pagination.sort&&"utilization"===t.pagination.sort||t.pagination.sort&&"-utilization"===t.pagination.sort?e.pagination.sortBy="utilization":(e.pagination.sortBy=void 0,e.pagination.descending=void 0),e.loading=!1,setTimeout(()=>{e.paintMayorista()},500),"ok"}))()},onRequestPaginate(t){this.loading=!0,t.pagination.descending=!t.pagination.descending;const e=this.bodyBuilder(t.pagination,this.body);this.getData(e),this.pagination.descending=!t.pagination.descending},bodyBuilder(t,e){return console.log(t),t.sortBy&&!0===t.descending?t.sort="utilization":t.sortBy&&!1===t.descending&&(t.sort="-utilization"),e?{pagination:t,fields:e}:{pagination:t}},updateInput(t,e){this.loading=!0,clearTimeout(this.typing),this.typing=setTimeout(()=>{this.body[e]=t;const a=this.bodyBuilder(this.pagination,this.body);this.getData(a)},500)},paintMayorista(){let t=document.querySelectorAll(".sinkSite"),e=document.querySelectorAll(".sourceSite");const a=[...t],n=[...e],i=a.length;let o=0;while(o<i)/_IB_/.test(a[o].textContent)||/_MC_/.test(a[o].textContent)||/_MCI_/.test(a[o].textContent)?a[o].parentElement.style.background="rgba(107,229,229,0.15)":/_IB_/.test(n[o].textContent)||/_MC_/.test(n[o].textContent)||/_MCI_/.test(n[o].textContent)?n[o].parentElement.style.background="rgba(107,229,229,0.15)":a[o].parentElement.style.background="transparent",o++},updateSelectStatus(t){this.loading=!0,this.body.status=t;const e=this.bodyBuilder(this.pagination,this.body);this.getData(e)},updateSelectMedia(t){this.loading=!0,this.body.media=t;const e=this.bodyBuilder(this.pagination,this.body);this.getData(e)},clearInputs(){this.body={sourceSite:null,sinkSite:null,utilization:null,media:"Todos",capacity:null,instanceName:null,status:"Todos"},this.pagination={page:1,rowsPerPage:5,rowsNumber:0,sortBy:"utilization",descending:!1};const t=this.bodyBuilder(this.pagination);this.getData(t)},openModal(t){console.log(t),this.dataModal=t,this.modalOpen=!0},uploadExcel(t){var e=this;return c()((function*(){e.modalCharge=!0;const a=new FormData(t.target),n=(yield e.$axios.post(e.LINKS_URL+"/uploadExcel",a),e.bodyBuilder(e.pagination));yield e.getData(n),e.modalCharge=!1}))()},alertar(t){var e=this;return c()((function*(){if(e.modalCreate=!1,e.modalEdit=!1,t)e.modalError=!0,setTimeout(()=>{e.modalError=!1},3e3);else{e.modalOk=!0;const t=e.bodyBuilder(e.pagination);yield e.getData(t),setTimeout(()=>{e.modalOk=!1},3e3)}}))()},deleteLink(){var t=this;return c()((function*(){const{_id:e}=t.linkDelete;t.modalCharge=!0;yield t.$axios.delete(`${t.LINKS_URL}/${e}/deleteLink`,{enlace:t.linkDelete});const a=t.bodyBuilder(t.pagination);yield t.getData(a),t.modalCharge=!1,t.modalConfirmDelete=!1}))()},openEditform(t){this.linkEdit=t,this.modalEdit=!0},openDeleteModal(t){this.linkDelete=t,this.modalConfirmDelete=!0},download(){var t=this;return c()((function*(){t.loading=!0,fetch(t.LINKS_URL+"/getData").then(t=>t.blob()).then(e=>{const a=window.URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=a;const i=new Date((new Date).toString().split("GMT")[0]+" UTC").toISOString().split(".")[0].replace("T"," ");n.download=`report_links_general_${i}.xlsx`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),t.loading=!1})}))()},processUtilization(t){if(t.utilizationHistory&&t.utilizationHistory.length>0){let e="";const a=[m()().month(),m()().subtract(1,"months").month(),m()().subtract(2,"months").month(),m()().subtract(3,"months").month()];for(let n=0;n<4;n++)e+=` ${this.getMaxUtilizationbyMonth(t.utilizationHistory,a[n])} `;return e}return""},getMaxUtilizationbyMonth(t,e){const a=t.filter(t=>m()(t.date).month()==e),n=a.sort((t,e)=>e.maxUtilization-t.maxUtilization);return n.length>0?n[0].maxUtilization.toFixed(2):""}},computed:r()({},Object(u["b"])("links",["LINKS_URL"]))},h=y,k=(a("3abb"),a("2877")),q=a("eaac"),C=a("9c40"),x=a("bd08"),v=a("357e"),w=a("db86"),_=a("ddd8"),S=a("27f9"),E=a("24e8"),D=a("f09f"),z=a("a370"),L=a("7d53"),B=a("0016"),T=a("4b7e"),O=a("a154"),M=a("cb32"),I=a("7f67"),N=a("eebe"),Q=a.n(N),U=Object(k["a"])(h,o,l,!1,null,null,null),F=U.exports;Q()(U,"components",{QTable:q["a"],QBtn:C["a"],QTr:x["a"],QTh:v["a"],QTd:w["a"],QSelect:_["a"],QInput:S["a"],QDialog:E["a"],QCard:D["a"],QCardSection:z["a"],QFile:L["a"],QIcon:B["a"],QCardActions:T["a"],QSpinnerBars:O["a"],QAvatar:M["a"]}),Q()(U,"directives",{ClosePopup:I["a"]});var R={components:{LinkTable:F},name:"PageIndex"},P=R,$=a("9989"),A=Object(k["a"])(P,n,i,!1,null,null,null);e["default"]=A.exports;Q()(A,"components",{QPage:$["a"]})}}]);