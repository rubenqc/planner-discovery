(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"3c2f":function(e,t,s){"use strict";var a=s("b237"),o=s.n(a);o.a},4492:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"flex column flex-center"},[s("div",{staticClass:"flex justify-between q-my-md items-start",staticStyle:{width:"90%"}},[s("h1",{staticClass:"h1",staticStyle:{"vertical-align":"top","line-height":"1"}},[e._v("Diagramas de Sitios")]),s("q-select",{staticStyle:{width:"350px"},attrs:{filled:"",clearable:"","hide-selected":"","fill-input":"","use-input":"","input-debounce":"0",label:"Nombre del site",hint:"Mínimo 3 carácteres",options:e.options},on:{filter:e.filterFn,input:e.changeVisData},model:{value:e.site,callback:function(t){e.site=t},expression:"site"}})],1),s("div",{staticClass:"q-mb-xl",staticStyle:{width:"90%",height:"70vh"}},[s("VisConponent",{key:e.visKey,attrs:{site:e.site},on:{reset:e.reset}})],1)])},o=[],i=s("ded3"),n=s.n(i),l=s("c973"),d=s.n(l),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"boxMain",staticClass:"bg-white",class:[e.fullscreen?"q-pa-md":""],staticStyle:{height:"100%"}},[s("div",{staticClass:"flex justify-between q-mb-md full-width"},[e.loading?s("div",[e._v("Cargando conteo de sites")]):s("div",{staticClass:"sitesCount"},[s("q-table",{attrs:{title:"Cantidad de Sites",data:e.data,columns:e.columns,"hide-bottom":""}})],1),e._m(0),s("div",[s("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",label:"Limpiar",icon:"autorenew"},on:{click:e.onReset}}),s("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",label:"Editar",icon:"edit"},on:{click:e.editOn}}),s("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",label:"Guardar",icon:"save"},on:{click:e.savePositions}}),s("q-btn",{attrs:{color:"primary",icon:e.$q.fullscreen.isActive?"fullscreen_exit":"fullscreen",label:e.$q.fullscreen.isActive?"Salir de FullScreen":"Fullscreen"},on:{click:e.toggle}})],1)]),e.loadsites?s("network",{ref:"network",style:"width: 100%; height : "+(e.fullscreen?"90vh":"70vh"),attrs:{nodes:e.nodes,edges:e.edges,options:e.options,events:["click","hoverNode","blurNode"]},on:{click:e.loadNodes,"hover-node":e.onHover,"blur-node":e.onBlur}}):s("div",[e._v("\n    Por favor seleccione un site\n  ")]),s("q-dialog",{attrs:{persistent:""},model:{value:e.modalCharge,callback:function(t){e.modalCharge=t},expression:"modalCharge"}},[s("q-card",[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v("Cargando")])]),s("q-card-section",{staticClass:"q-pt-none flex column items-center justify-center"},[s("p",[e._v("por favor no cierre la pestaña.")])])],1)],1),e.dataRouter?s("q-dialog",{attrs:{seamless:"",position:"bottom"},model:{value:e.seamless,callback:function(t){e.seamless=t},expression:"seamless"}},[s("q-card",{staticStyle:{width:"350px"}},[s("q-card-section",{staticClass:"row items-center no-wrap"},[s("div",[s("div",{staticClass:"text-weight-bold"},[e._v(e._s(e.dataRouter.site))]),e._l(e.dataRouter.routerNames,(function(t,a){return s("div",{key:a},[e._v(e._s(t))])}))],2)])],1)],1):e._e()],1)},c=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex",staticStyle:{width:"450px",margin:"16px"}},[a("div",{staticClass:"flex items-center q-mr-lg"},[a("img",{staticStyle:{height:"2rem"},attrs:{src:s("ba65"),alt:""}}),a("span",[e._v("  Cargar NE")])]),a("div",{staticClass:"flex items-center q-mr-lg"},[a("img",{staticStyle:{height:"2rem"},attrs:{src:s("5071"),alt:""}}),a("span",[e._v("  Cargar FE")])]),a("div",{staticClass:"flex items-center q-mr-lg"},[a("img",{staticStyle:{height:"2rem"},attrs:{src:s("109c"),alt:""}}),a("span",[e._v("  Cargar FE y NE")])]),a("div",{staticClass:"flex column q-mt-sm "},[a("div",{staticClass:"flex items-center"},[a("span",[e._v("ENLACE FO    ")]),a("div",{staticStyle:{height:"3px",width:"50px",border:"2px solid rgb(72, 232, 240)",display:"inline-block"}})]),a("div",{staticClass:"flex items-center"},[a("span",[e._v("ENLACE MW  ")]),a("div",{staticStyle:{height:"3px",width:"50px",border:"2px dashed rgb(255, 152, 0)",display:"inline-block"}})])])])}],g=(s("e6cf"),s("a79d"),s("b329")),h=s("2f62"),m={props:{site:String},components:{Network:g["Network"]},created(){},data(){return{loading:!0,columns:[{name:"tipo",required:!0,label:"Type",align:"left",field:e=>e.tipo,format:e=>""+e,sortable:!0},{name:"amount",align:"center",label:"Cantidad",field:"amount",sortable:!0}],data:[],dataResult:null,nodes:[],edges:[],options:null,onEdit:!1,modalCharge:!1,loadsites:!1,fullscreen:!1,seamless:!1,dataRouter:null}},mounted(){this.site&&this.draw(this.site),console.log("previous mounted"),this.$axios.get(this.LINKS_URL+"/getLinkTypesCounts").then(e=>{this.data=[{tipo:"BH",amount:e.data.result["BH"]},{tipo:"LH",amount:e.data.result["LH"]},{tipo:"FO",amount:e.data.result["FO"]},{tipo:"RENTADO-FO",amount:e.data.result["RENTADO-FO"]||0}]}).finally(()=>this.loading=!1)},methods:{draw(e){console.log(this.modalCharge),this.modalCharge=!0,this.loadsites=!0,fetch(`${this.LINKS_URL}/getTophBySite?site=${e}`).then(e=>e.json()).catch(e=>console.log(e)).then(e=>{this.dataResult=e,e.nodes=e.nodes.map(t=>{const s=e.edges.filter(e=>e.to===t.id).length,a=e.edges.filter(e=>e.from===t.id).length,{feCant:o,neCant:i}=t,{image:l,loadtype:d}=this.calcuteImage({neLoad:a,feLoad:s,feCant:o,neCant:i});let r=!1;return s===o&&a===i&&(r=!0),n()(n()({},t),{},{image:l,loadtype:d,shape:r?"dot":"circularImage",isAllgraphic:r})}),this.nodes=e.nodes,this.edges=e.edges,this.options={physics:!1,interaction:{dragNodes:!1,hover:!0},edges:{smooth:{enabled:!0,type:"curvedCW",roundness:.2},arrows:"from"}},setTimeout(e=>{console.log(this.modalCharge,"2"),this.modalCharge=!1,this.$refs.network.focus(1)},100)})},editOn(){this.options.interaction.dragNodes=!0,this.onEdit=!0},savePositions(){var e=this;return d()((function*(){const t=e.$refs.network.getPositions(),s=e.nodes.map(e=>({id:e.id,label:e.label,x:t[""+e.id].x,y:t[""+e.id].y})),a=e.$q.dialog({title:"Actualizando",message:"Un momento por favor",ok:!1}),o=yield e.$axios.patch(e.LINKS_URL+"/updatePositions",{nodes:s});200===o.status?(console.log(o.data),e.options.interaction.dragNodes=!1,e.onEdit=!1,a.hide()):console.warn(o.data)}))()},loadNodes(e){var t=this;return d()((function*(){if(e.nodes.length>0&&!t.onEdit){const s=t.$refs.network.getNode(e.nodes[0]);if(s.isAllgraphic||"nearends"!==s.loadtype)if(s.isAllgraphic||"farends"!==s.loadtype){if(!s.isAllgraphic&&"both"===s.loadtype){console.log("Ambos"),t.modalCharge=!0,t.nodes.map((function(e){return delete e.isAllgraphic,delete e.shape,delete e.image,delete e.loadtype,e}));const a=yield t.$axios.post(t.LINKS_URL+"/getDependecies",{nodes:t.nodes,edges:t.edges,site:s.label});t.nodes=a.data.nodes,t.edges=a.data.edges;const o=yield t.$axios.post(t.LINKS_URL+"/getFarEnds",{nodes:t.nodes,edges:t.edges,site:s.label});t.nodes=o.data.nodes.map(e=>{const s=o.data.edges.filter(t=>t.to===e.id).length,a=o.data.edges.filter(t=>t.from===e.id).length,{feCant:i,neCant:l}=e;console.log(e.label,`NELOAD/FELOAD : ${a}/${l} --- ${s}/${i}`);const{image:d,loadtype:r}=t.calcuteImage({neLoad:a,feLoad:s,feCant:i,neCant:l});let c=!1;return s===i&&a===l&&(c=!0),n()(n()({},e),{},{image:d,loadtype:r,shape:c?"dot":"circularImage",isAllgraphic:c})}),t.edges=o.data.edges,setTimeout(s=>{t.modalCharge=!1,t.$refs.network.focus(e.nodes[0]),t.$refs.network.selectNodes([e.nodes[0]])},100)}}else{console.log("Farends"),t.modalCharge=!0,t.nodes.map((function(e){return delete e.isAllgraphic,delete e.shape,delete e.image,delete e.loadtype,e}));const a=yield t.$axios.post(t.LINKS_URL+"/getFarEnds",{nodes:t.nodes,edges:t.edges,site:s.label});t.nodes=a.data.nodes.map(e=>{const s=a.data.edges.filter(t=>t.to===e.id).length,o=a.data.edges.filter(t=>t.from===e.id).length,{feCant:i,neCant:l}=e;console.log(e.label,`NELOAD/FELOAD : ${o}/${l} --- ${s}/${i}`);const{image:d,loadtype:r}=t.calcuteImage({neLoad:o,feLoad:s,feCant:i,neCant:l});let c=!1;return s===i&&o===l&&(c=!0),n()(n()({},e),{},{image:d,loadtype:r,shape:c?"dot":"circularImage",isAllgraphic:c})}),t.edges=a.data.edges,setTimeout(s=>{t.modalCharge=!1,t.$refs.network.focus(e.nodes[0]),t.$refs.network.selectNodes([e.nodes[0]])},100)}else{console.log("nearEnds"),t.modalCharge=!0,t.nodes.map((function(e){return delete e.isAllgraphic,delete e.shape,delete e.image,delete e.loadtype,e}));const a=yield t.$axios.post(t.LINKS_URL+"/getDependecies",{nodes:t.nodes,edges:t.edges,site:s.label});t.nodes=a.data.nodes.map(e=>{const s=a.data.edges.filter(t=>t.to===e.id).length,o=a.data.edges.filter(t=>t.from===e.id).length,{feCant:i,neCant:l}=e;console.log(e.label,`NELOAD/FELOAD : ${o}/${l} --- ${s}/${i}`);const{image:d,loadtype:r}=t.calcuteImage({neLoad:o,feLoad:s,feCant:i,neCant:l});let c=!1;return s===i&&o===l&&(c=!0),n()(n()({},e),{},{image:d,loadtype:r,shape:c?"dot":"circularImage",isAllgraphic:c})}),t.edges=a.data.edges,setTimeout(s=>{t.modalCharge=!1,t.$refs.network.focus(e.nodes[0]),t.$refs.network.selectNodes([e.nodes[0]])},100)}}}))()},calcuteImage({neLoad:e,feLoad:t,feCant:a,neCant:o}){return e===o&&t!==a?{image:s("5071"),loadtype:"farends"}:e!==o&&t===a?{image:s("ba65"),loadtype:"nearends"}:e!==o&&t!==a?{image:s("109c"),loadtype:"both"}:e===o&&t===a?{image:void 0,loadtype:void 0}:void 0},onReset(){this.$emit("reset")},toggle(e){this.$q.fullscreen.toggle(this.$refs.boxMain).then(()=>{}).catch(e=>{alert(e)})},onHover(e){const t=this.$refs.network.getNode(e.node);t.dataRouter&&(this.dataRouter=n()(n()({},t.dataRouter),{},{site:t.label}),this.seamless=!0)},onBlur(e){const t=this.$refs.network.getNode(e.node);t.dataRouter&&(this.seamless=!1)}},computed:n()({},Object(h["b"])("links",["LINKS_URL"])),watch:{site(e){if(e){const t=this.nodes.filter(t=>t.label===e);t.length>0?(this.$refs.network.focus(t[0].id),this.$refs.network.selectNodes([t[0].id])):this.draw(e)}},"$q.fullscreen.isActive"(e){this.fullscreen=e}}},u=m,p=(s("3c2f"),s("2877")),f=s("eaac"),v=s("9c40"),C=s("24e8"),b=s("f09f"),y=s("a370"),w=s("eebe"),x=s.n(w),$=Object(p["a"])(u,r,c,!1,null,null,null),L=$.exports;x()($,"components",{QTable:f["a"],QBtn:v["a"],QDialog:C["a"],QCard:b["a"],QCardSection:y["a"]});var N={components:{VisConponent:L},created(){},name:"PageDiagramComplex",data(){return{model:null,options:["Escribe 3 caracteres"],original:null,site:null,visKey:1}},methods:{searchOptions(e){var t=this;return d()((function*(){const s=yield t.$axios.get("http://186.163.3.23:83/api/ingtx/sites/find/siteName/tx?term="+e);let a=[];s.data.map(e=>a.push(e["siteName"])),t.options=a,t.original=a}))()},filterFn(e,t,s){e.length<3?s():t(()=>{this.searchOptions(e)})},changeVisData(e){e>3&&(this.site=e)},reset(){this.site=null,this.visKey++}},computed:n()({},Object(h["b"])("links",["LINKS_URL"]))},k=N,_=s("9989"),q=s("ddd8"),S=s("293e"),E=Object(p["a"])(k,a,o,!1,null,null,null);t["default"]=E.exports;x()(E,"components",{QPage:_["a"],QSelect:q["a"],QSkeleton:S["a"]})},b237:function(e,t,s){}}]);